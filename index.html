<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>CSS Quiz Challenge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        /* CSS code starts here (Unchanged for consistency) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap');

        :root {
            --color-primary: #3b82f6;
            --color-secondary: #f97316;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-muted: #9ca3af;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-light: #f8fafc;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        h1, h2, h3 {
            color: var(--color-primary);
            text-align: center;
            margin-top: 0;
        }
        
        .main-class-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        button {
            background-color: var(--color-primary);
            color: var(--text-light);
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        button:hover:not(:disabled) {
            background-color: #2563eb;
        }
        button:disabled {
            background-color: #64748b;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .option {
            background-color: #334155;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .option:hover:not(.disabled) {
            border-color: var(--color-primary);
        }
        /* Crucial Styles for Feedback */
        .option.correct {
            background-color: var(--color-success);
            color: var(--bg-dark);
            border-color: var(--color-success);
            font-weight: bold;
        }
        .option.wrong {
            background-color: var(--color-error);
            color: var(--text-light);
            border-color: var(--color-error);
        }
        .option.disabled {
            pointer-events: none;
            cursor: default;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 10px;
        }
        .navigation button {
            width: 50%;
            margin: 0;
        }
        .hidden {
            display: none !important;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-card {
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
        }
        /* CSS code ends here */
    </style>
</head>
<body>
    <div class="main-class-container">
        <main class="container">
            <div id="loginSection" class="card">
                <h1>CSS Quiz Challenge</h1> 
                <p class="muted-text" style="text-align: center;">Created by Rameel Tanveer</p>

                <input id="nameInput" type="text" placeholder="Type your name" autocomplete="off" />
                <button id="startQuiz">Start Quiz</button>

                <p id="loginMsg" style="text-align: center; color: var(--color-error);"></p>
                <hr>
                </div>
            <section id="quizApp" class="card hidden">
                <div class="quiz-header" style="display: flex; justify-content: space-between;">
                    <span id="progressText" style="font-weight: bold; color: var(--color-success);">Question 0 / 0</span>
                    <span id="qTimer" style="color: var(--color-warning);">00:00</span>
                </div>

                <div class="quiz-content">
                    <h2 id="questionText" style="text-align: left;">Question will appear here</h2>
                    <div id="optionsList" class="options-list">
                        </div>
                    <div class="navigation">
                        <button id="nextBtn">Next</button>
                    </div>
                </div>
            </section>
        </main>
        
        <div id="resultModal" class="modal hidden">
            <div class="modal-card">
                <h2 id="modalTitle">Result</h2>
                <p id="modalMessage">Modal message: You scored XX%</p>
                <button id="modalClose">Close</button>
            </div>
        </div>

    </div>
    
    <script>
        /* ----------------------------------------------------------------- */
        /* --------- SCRIPT.JS - FINAL, CLEANED, WORKING VERSION ----------- */
        /* ----------------------------------------------------------------- */
        
        /* ---------- CONFIG ---------- */
        const TOTAL_MINUTES = 40; // Total time limit removed to simplify, but can be added back
        const PER_QUESTION_SECONDS = 40;
        const FIXED_WHATSAPP = '03196393269';
        const FIXED_EMAIL = 'rameeltanveer19@gmail.com';
        const IS_TESTING_MODE = true; // Set to true for easy testing
        
        /* ---------- QUESTION BANK (40+ items) ---------- */
        // NOTE: The answers are stored as strings (e.g., "display: flex;"), not HTML entities.
        const BANK = [
          {q:"Which CSS property sets text color?", a:"color", o:["font-color","text-color","color","foreground"], topic:"Colors"},
          {q:"Which HEX code represents black?", a:"#000000", o:["#FFFFFF","#000000","#FF0000","#00FF00"], topic:"Colors"},
          {q:"How to prevent background image repeating?", a:"background-repeat: no-repeat;", o:["background-repeat: repeat-x;","background-repeat: no-repeat;","background-attach: fixed;","repeat: none;"], topic:"Colors"},
          {q:"Which property sets background color?", a:"background-color", o:["bgcolor","background-color","color-bg","bg"], topic:"Colors"},
          {q:"What does rgba(0,0,0,0.5) control?", a:"color with opacity", o:["font size","color with opacity","border style","background-image"], topic:"Colors"},
          {q:"HEX #FFFFFF means which color?", a:"white", o:["black","white","gray","transparent"], topic:"Colors"},
          {q:"Which property controls font size?", a:"font-size", a:"font-size", o:["font-weight","font-size","font-family","text-size"], topic:"Text & Fonts"},
          {q:"Which property makes text bold?", a:"font-weight", o:["font-style","font-weight","font-variant","text-bold"], topic:"Text & Fonts"},
          {q:"How to make text uppercase?", a:"text-transform: uppercase;", o:["text-case: upper;","text-transform: uppercase;","font-variant: caps;","transform-text:upper"], topic:"Text & Fonts"},
          {q:"Which property sets font family?", a:"font-family", o:["font","font-family","font-type","typeface"], topic:"Text & Fonts"},
          {q:"How to underline text via CSS?", a:"text-decoration: underline;", o:["text-underline: true;","text-decoration: underline;","underline:true;","font-decoration: underline;"], topic:"Text & Fonts"},
          {q:"Which property changes line height?", a:"line-height", o:["line-space","line-height","text-gap","height-line"], topic:"Text & Fonts"},
          {q:"What property adjusts letter spacing?", a:"letter-spacing", o:["word-spacing","letter-spacing","text-space","char-spacing"], topic:"Text & Fonts"},
          {q:"Which property sets inner spacing?", a:"padding", o:["margin","padding","border","gap"], topic:"Box Model"},
          {q:"Which property sets outer spacing?", a:"margin", o:["padding","margin","gap","spacing"], topic:"Box Model"},
          {q:"Shorthand for border width, style and color?", a:"border: 2px solid black;", o:["border: 2px solid black;","border-width:2px;","border-style:solid;","border-color:black;"], topic:"Box Model"},
          {q:"How to make corners rounded?", a:"border-radius", o:["border-round","border-radius","corner-radius","round-corner"], topic:"Box Model"},
          {q:"Which property controls overflow?", a:"overflow", o:["overflow","wrap","clip","flow"], topic:"Box Model"},
          {q:"Which sets width of box?", a:"width", o:["size","width","box-width","max-width"], topic:"Box Model"},
          {q:"Which property controls box shadow?", a:"box-shadow", o:["shadow","box-shadow","text-shadow","drop-shadow"], topic:"Box Model"},
          {q:"position: absolute; positions relative to?", a:"nearest positioned ancestor", o:["viewport","nearest positioned ancestor","body element","document"], topic:"Positioning"},
          {q:"What does position: fixed do?", a:"fixes element relative to viewport", o:["fixes within parent","fixes element relative to viewport","makes element static","removes element"], topic:"Positioning"},
          {q:"How to center block horizontally?", a:"margin: 0 auto;", o:["align:center;","margin:0 auto;","text-align:center;","position:center;"], topic:"Positioning"},
          {q:"Which property controls stacking order?", a:"z-index", o:["z-index","stack-order","order","layer"], topic:"Positioning"},
          {q:"Which position keeps element in normal flow?", a:"static", o:["static","relative","absolute","fixed"], topic:"Positioning"},
          {q:"Relative position moves element relative to?", a:"its normal position", o:["viewport","parent","its normal position","document"], topic:"Positioning"},
          {q:"How to make a container flex?", a:"display: flex;", o:["display:block;","display:flex;","display:inline;","flex:yes;"], topic:"Flexbox"},
          {q:"Center items horizontally in flex?", a:"justify-content: center;", o:["align-items:center;","justify-content:center;","flex-center:true;","center-items:both;"], topic:"Flexbox"},
          {q:"Center items vertically in flex?", a:"align-items: center;", o:["align-items:center;","justify-items:center;","vertical-align:center;","align-content:center"], topic:"Flexbox"},
          {q:"Space between items in flex?", a:"justify-content: space-between;", o:["space-between","justify:space","justify-content: space-between;","gap:space"], topic:"Flexbox"},
          {q:"Which property wraps flex items?", a:"flex-wrap", o:["wrap","flex-wrap","flex-flow","flex-direction"], topic:"Flexbox"},
          {q:"How to set direction in flex?", a:"flex-direction", o:["flex-direction","direction","flex-flow","align-direction"], topic:"Flexbox"},
          {q:"Shorthand for flex grow/shrink/basis?", a:"flex", o:["flex","flex-basis","flex-flow","flex-grow"], topic:"Flexbox"},
          {q:"Which rule imports fonts?", a:"@import url('font-link');", o:["@font-face","@import url('font-link');","@font-link","@font"], topic:"Misc"},
          {q:"How to hide element but keep space?", a:"visibility: hidden;", o:["display:none;","visibility:hidden;","opacity:0;","hide:true;"], topic:"Misc"},
          {q:"Which hides element completely and removes space?", a:"display: none;", o:["visibility:hidden;","display:none;","opacity:0;","hidden:true;"], topic:"Misc"},
          {q:"How to write CSS comment?", a:"/* comment */", o:["// comment","/* comment */","","# comment"], topic:"Misc"},
          {q:"What does box-sizing:border-box do?", a:"includes padding in width", o:["excludes padding","includes padding in width","collapses margin","adds border outside"], topic:"Misc"},
          {q:"Which selects class in CSS?", a:".classname", o:["#classname",".classname","classname","*classname"], topic:"Misc"},
          {q:"Which property centers inline text?", a:"text-align", o:["align","text-align","center-inline","inline-align"], topic:"Misc"}
        ];

        /* ---------- STATE & UI refs ---------- */
        let userName = null;
        let questions = []; 
        let current = 0; 
        let perQuestionSecondsLeft = PER_QUESTION_SECONDS;
        let questionTimerId = null, answeredThisQ = false;
        
        const loginSection = document.getElementById('loginSection');
        const nameInput = document.getElementById('nameInput');
        const startQuizBtn = document.getElementById('startQuiz'); 
        const loginMsg = document.getElementById('loginMsg');
        const quizApp = document.getElementById('quizApp');
        const progressText = document.getElementById('progressText');
        const questionText = document.getElementById('questionText');
        const optionsList = document.getElementById('optionsList');
        const nextBtn = document.getElementById('nextBtn');
        const qTimerEl = document.getElementById('qTimer');
        const resultModal = document.getElementById('resultModal');
        const modalClose = document.getElementById('modalClose');

        /* ---------- HELPERS ---------- */
        function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
        function formatTime(s){ const m=Math.floor(s/60).toString().padStart(2,'0'); const sec=(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }
        
        // This is crucial for fixing display issues with HTML entities like <, >
        function unescapeHtml(s){ 
            const temp = document.createElement('div');
            temp.innerHTML = s;
            return temp.textContent || temp.innerText || '';
        }

        /* ---------- QUIZ FLOW ---------- */
        startQuizBtn.addEventListener('click', ()=>{
          const val = nameInput.value.trim();
          loginMsg.textContent = "";
          
          if (!val) { 
            loginMsg.textContent = "براہِ کرم اپنا نام لکھیں / Please enter your name"; 
            return; 
          }
          
          userName = val; beginQuiz();
        });
        nextBtn.addEventListener('click', ()=> { if(!nextBtn.disabled) goNext(); });
        modalClose.addEventListener('click', ()=> { resultModal.classList.add('hidden'); });


        function beginQuiz(){
          // Initialize questions array with an empty userAnswer property
          questions = shuffle(BANK.slice()).slice(0,40).map(q => ({...q, userAnswer: null})); 
          current = 0;
          
          loginSection.classList.add('hidden');
          quizApp.classList.remove('hidden');

          loadQuestion();
        }

        function loadQuestion(){
          answeredThisQ = false;
          nextBtn.disabled = true;
          const item = questions[current];
          
          progressText.innerHTML = `Question ${current + 1} / ${questions.length}`;
          questionText.textContent = item.q;
          
          const opts = shuffle(item.o.slice());
          
          // FIX: No HTML Escaping used here. We directly inject the option string.
          optionsList.innerHTML = opts.map(opt => `<div class="option" role="button" tabindex="0">${opt}</div>`).join('');
          
          document.querySelectorAll('.option').forEach(el=>{
            el.addEventListener('click', ()=> selectOption(el, item));
          });
          startQuestionTimer();
        }

        /* ---------------------------------------------------- */
        /* ---------- SELECT OPTION (THE FINAL WORKING FIX) --- */
        /* ---------------------------------------------------- */
        function selectOption(el, item){
          if(answeredThisQ) return;
          
          // 1. DOM سے براہ راست ٹیکسٹ لیں
          const chosenText = el.textContent.trim(); 
          // 2. صحیح جواب کو Unescape کریں
          const correctTextUnescaped = unescapeHtml(item.a.trim()); 

          // 3. صارف کا جواب محفوظ کریں
          questions[current].userAnswer = chosenText;
          
          answeredThisQ = true;
          document.querySelectorAll('.option').forEach(o=> o.classList.add('disabled'));

          // 4. موازنہ کریں
          if(chosenText === correctTextUnescaped){ 
            el.classList.add('correct');
          } else {
            el.classList.add('wrong');
            
            // صحیح جواب کو سبز دکھانے کے لیے
            document.querySelectorAll('.option').forEach(o=>{
              if(o.textContent.trim() === correctTextUnescaped) {
                o.classList.add('correct');
              }
            });
          }
          nextBtn.disabled = false;
          stopQuestionTimer();
        }
        /* ---------------------------------------------------- */

        function goNext(){
          current++;
          if(current < questions.length) loadQuestion();
          else finishQuiz();
        }
        
        function goNextAfterAuto(){
          // Time out means skipped (userAnswer is null)
          if(current < questions.length - 1){ current++; loadQuestion(); } 
          else finishQuiz();
        }
        
        /* ---------- TIMERS ---------- */
        function startQuestionTimer(){
          perQuestionSecondsLeft = PER_QUESTION_SECONDS;
          qTimerEl.textContent = formatTime(perQuestionSecondsLeft);
          clearInterval(questionTimerId); // Clear any previous timer
          questionTimerId = setInterval(()=>{
            perQuestionSecondsLeft--;
            qTimerEl.textContent = formatTime(perQuestionSecondsLeft);
            if(perQuestionSecondsLeft <= 0){
              clearInterval(questionTimerId);
              // Time out = Skipped
              setTimeout(()=> goNextAfterAuto(), 700);
            }
          }, 1000);
        }
        function stopQuestionTimer(){ if(questionTimerId) clearInterval(questionTimerId); }


        /* ---------------------------------------------------- */
        /* ---------- FINISH QUIZ (Detailed Report) ----------- */
        /* ---------------------------------------------------- */
        function finishQuiz(){
            stopQuestionTimer();
            
            // 1. تمام شمار (Counts) نکالیں
            const correctQuestions = questions.filter(q => q.userAnswer && q.userAnswer.trim() === unescapeHtml(q.a.trim()));
            const wrongQuestions = questions.filter(q => q.userAnswer && q.userAnswer.trim() !== unescapeHtml(q.a.trim()));
            const skippedQuestions = questions.filter(q => q.userAnswer === null);
            
            const total = questions.length;
            const correct = correctQuestions.length;
            const wrong = wrongQuestions.length;
            const skipped = skippedQuestions.length;
            const percent = Math.round((correct/total)*100);

            // 2. غلط سوالات کی فہرست (List of Wrong Answers) بنائیں
            const wrongListHtml = wrongQuestions.length > 0 ? `
                <h2 style="color:#ef4444; margin-top: 30px;">غلط سوالات / Wrong Answers</h2>
                ${wrongQuestions.map((q, index) => `
                    <div style="background: #2e3a4e; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="font-weight: bold; color: #7dd3fc;">${index + 1}. ${q.q}</p>
                        <p style="color: #ef4444;">آپ کا جواب / Your Answer: <strong>${q.userAnswer}</strong></p>
                        <p style="color: #a7f3d0;">صحیح جواب / Correct Answer: <strong>${q.a}</strong></p>
                    </div>
                `).join('')}
            ` : `<p style="color:#a7f3d0; font-size: 1.2rem; margin-top: 20px;">تمام سوالات درست! / All answers were correct!</p>`;


            // 3. رزلٹ ونڈو HTML بنائیں
            const resultWindow = window.open('','_blank');
            const resultHtml = `
              <html lang="en" dir="ltr">
              <head><meta charset="utf-8"><title>Quiz Result — ${userName}</title>
              <style>
                body{font-family:Arial,Helvetica,sans-serif; padding:28px; background:#0f172a; color:#fff}
                .box{background:#071028;padding:18px;border-radius:10px; max-width:800px;margin:30px auto}
                h1{color:#7dd3fc; text-align: center;}
                table{width:100%; border-collapse:collapse; margin-top:20px; text-align:left;}
                th, td {padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);}
                th {color: #7dd3fc;}
                .percent{font-size:2.5rem; font-weight:700; color:${percent>=70? '#a7f3d0':'#fecaca'}; margin: 10px 0; text-align: center;}
              </style>
              </head>
              <body>
                <div class="box">
                  <h1>نتیجہ — ${userName}</h1>
                  <div class="percent"> ${percent} ٪</div>
                  <table>
                    <tr><th>Total Questions</th><td>${total}</td></tr>
                    <tr style="color:#a7f3d0;"><th>Correct Answers</th><td>${correct}</td></tr>
                    <tr style="color:#ef4444;"><th>Wrong Answers</th><td>${wrong}</td></tr>
                    <tr><th>Skipped</th><td>${skipped}</td></tr>
                    <tr><th>Time Limit</th><td>${formatTime(questions.length * PER_QUESTION_SECONDS)}</td></tr>
                  </table>
                  
                  ${wrongListHtml}
                </div>
              </body>
              </html>`;
            resultWindow.document.write(resultHtml);
            resultWindow.document.close();
            
            // 4. WhatsApp & Email
            const msg = encodeURIComponent(`Quiz Result for ${userName}:\nPercentage: ${percent}%\nCorrect: ${correct}\nWrong: ${wrong}\nSkipped: ${skipped}`);
            window.open(`https://wa.me/${FIXED_WHATSAPP}?text=${msg}`, '_blank');
            window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${FIXED_EMAIL}&su=CSS Quiz Result&body=${msg}`, '_blank');
            
            // 5. Show Modal
            resultModal.classList.remove('hidden');
            document.getElementById('modalTitle').textContent = percent >= 70 ? "مبارک ہو!" : "کوشش جاری رکھیں";
            document.getElementById('modalMessage').textContent = `آپ کا سکور ${percent}% ہے۔ تفصیلات نئی ونڈو میں دیکھیں!`;
        }

    </script>
</body>
</html>
